<!-- Start Content -->

<!--start Breadcrumb-->

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="cpanel/home" class="alink">Dashboard</a></li>
    <li class="breadcrumb-item active" aria-current="page">Products</li>
  </ol>
</nav>
<!--/end Breadcrumb-->

<!-- // Start Content on PAGE /////////////////////////////////////////////////////// -->
<div class="row">
  <div class="content-title">
    <div class="col-md-8 col-sm-8 col-xs-12">
      <h2>Products <b>Lists</b></h2>
    </div>
    <!--/col-->
  </div>
  <!--/content-title-->
</div>
<!--/row-->

<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <p class="text-th">แสดงรายการ สินค้า ทั้งหมด <b class="text-green">41</b> รายการ</p>
        <div class="nav navbar-right"><a href="product_add.php" class="btn btn-primary btn-sm"><i class="fa fa-fw fa-plus"></i> Add New Product</a></div>
      </div>
      <!--/x_title-->
      <div class="x_content">
        <div class="dataTables_wrapper">
          <form id="filterForm" method="GET" class="form form-group" style="margin-bottom:6px;">
            <div class="top">
              <div class="dataTables_filter">
                <label>Search
                  <input type="text" id="search" name="search" class="form-control input-sm autoFilter" value="" onchange="this.form.submit()">
                </label>
              </div>
              <div class="dataTables_length">
                <label>Record/Page
                  <select name="display" class="form-control input-sm autoFilter" onchange="this.form.submit()">
                    <option value="10">10</option>
                    <option value="25" selected="">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="1000">1000</option>
                  </select>
                </label>
              </div>
              <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination">
                  <!-- Previous -->
                  <!-- First -->

                  <!-- Main Loop -->
                  <li class="paginate_button active"><a href="?page=1&amp;kioskid=&amp;productid=&amp;display=25&amp;datefrom=&amp;date=&amp;onhour=&amp;search=&amp;refill=&amp;action=filtered&amp;trntype=&amp;permisid=&amp;slotid=&amp;slotaction=">1</a></li>

                  <!-- Last -->
                  <!-- Next -->
                </ul>
              </div>
            </div>
          </form>
        </div>
        <!--/dataTables_wrapper-->

        <table class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline">
          <thead>
            <tr>
              <th> ID</th>
              <th> SKU</th>
              <th class="text-center">Image</th>
              <th> Name</th>
              <th> Price</th>
              <th> Category </th>
              <th>Description </th>
              <th>Status </th>
              <th>Last Update </th>
              <th class="text-center">Action</th>
            </tr>
          </thead>

          <tbody id='mytable'>
            <tr class='row_tablecontent' style='display:none'>
              <td class="prd_id ordinal"> ID</td>
              <td class="prd_SKU"> SKU</td>
              <td><a data-toggle="modal" data-target="#modelPrd" class="avatar_link prd_edit_link" modal-name="กระทิงแดง 145 ซีซี.  (ขวดกลม)"> <img src="" class="avatar prd_product_image" style=" height:50px;"> </a></td>
              <td>
                  <a href="#" class="prd_product_name prd_edit_link">
                  Product Name
                  </a>
              </td>
              <td>
                  <span class="prd_init_price">Price</span> 
                  <small style="color:#ccc;">THB</small>
              </td>
              <th class="prd_category_name"> Category Unkhow</th>
              <td class="prd_description"> Description </td>
              <td class="prd_status"> Status </td>
              <td class="prd_lastupdate">Last Update </td>
              <td class="text-center">
                  <button class="btn btn-silver btn-xs prd_edit_link" title="edit" href="#">
                      <i class="fa fa-fw fa-pencil"></i>
                  </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!--/x_content-->
    </div>
    <!--/x_panel-->
  </div>
  <!--/col-md-12-->

</div>
<!--/row-->

<!-- // End Content on PAGE /////////////////////////////////////////////////////// -->
<script>
     var template_of_testtable = $('#mytable').first().html();    // นำไปใส่ที่ <tbody id='mytable'>  และ <tr class='row_tablecontent' style='display:none'>
     //console.log(template_of_testtable);
        var maintable = $('#mytable').first();

    $.get('/api/member/productlist',function(objdata){  // ลิงค์ที่กำหนดใน nodered 
       // console.log(objdata);
       // แสดงข้อมูลใน table 
       for(var x=0; x < objdata.length; x++){  
           var TR = tablerow(maintable,'prd',objdata[x],template_of_testtable);  // ในส่วน <td> ตัวอย่าง <th class="prd_category_name"> Category Unkhow</th>
          
           // กรณีมีปุ่ม Edit  
           TR.find('.prd_edit_link').attr('href','/cpanel/product/edit?productid='+ objdata[x].id);  
           
           // category_id อ้างอิงกับ table อื่น  
           TR.find('.prd_category_name').html(objdata[x].category.name);  // category.name ที่เรียกนำมาแสดง 
           TR.show();
       }
       console.log("SET THE LINK");

       $('.prd_edit_link').on('click',function(obj){  
           /* กำหนด class .prd_edit_link  กดแล้วให้ไปที่หน้าแก้ไข  ตัวอย่าง 
            <a href="#" class="prd_product_name prd_edit_link">  Product Name </a> */
            //console.log($(obj).attr('href'));
            go2View($(obj.currentTarget).attr('href'),'Editing Product');
            return false;
       });

    });


$('.alink').on('click',function(obj){  // ตัวอย่าง <a href="cpanel/staff/qrcode" class='alink'>QR Code</a> 
  go2View($(obj.target).attr('href'),'Kapook Vending');
  return false;
});

</script>
