<!--start Breadcrumb-->
<!-- Start Content -->

<!--start Breadcrumb-->

<nav aria-label="breadcrumb">
   <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="cpanel/home" class="alink">Dashboard</a></li>
      <li class="breadcrumb-item" aria-current="page">Routes</li>
   </ol>
</nav>
<!--/end Breadcrumb-->

<!-- // Start Content on PAGE /////////////////////////////////////////////////////// -->
<div class="row">
   <div class="content-title">
      <div class="col-md-8 col-sm-8 col-xs-12">
         <h2>Route <b>Lists</b></h2>
      </div>
      <!--/col-->
   </div>
   <!--/content-title-->
</div>
<!--/row-->

<div class="row" >
   <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel">
         <div class="x_title">
            <p class="text-th">แสดงรายการเส้นทางเดินรถ ทั้งหมด <b class="text-green " id="total_item"></b> รายการ</p>
            <div class="nav navbar-right"><a href="/cpanel/route/add" class="alink btn btn-primary btn-sm"><i class="fa fa-fw fa-plus"></i> Add New Product</a></div>
         </div>
         <!--/x_title-->
         <div class="x_content">
            <div class="dataTables_wrapper">
                <form id="filterForm" method="GET" class="form form-group" style="margin-bottom:6px;" onsubmit="return filterFormsubmit()">
                    
                  <div class="top">
                     <div class="dataTables_filter">
                        <label>Search
                           <input type="text" id="search_route" name="search" class="form-control input-sm autoFilter" value="" >
                        </label>
                     </div>
                     <div class="dataTables_length">
                        <label>Record/Page
                           <select name="display" class="form-control input-sm autoFilter" onchange="this.form.submit()">
                              <option value="10">10</option>
                              <option value="25" selected="">25</option>
                              <option value="50">50</option>
                              <option value="100">100</option>
                              <option value="1000">1000</option>
                           </select>
                        </label>
                     </div>
                     <div class="dataTables_paginate paging_simple_numbers">
                        <ul class="pagination">
                           <!-- Previous -->
                           <!-- First -->

                           <!-- Main Loop -->
                           <li class="paginate_button active"><a href="?page=1&amp;kioskid=&amp;productid=&amp;display=25&amp;datefrom=&amp;date=&amp;onhour=&amp;search=&amp;refill=&amp;action=filtered&amp;trntype=&amp;permisid=&amp;slotid=&amp;slotaction=">1</a></li>

                           <!-- Last -->
                           <!-- Next -->
                        </ul>
                     </div>
                  </div>
               </form>
            </div>
            <!--/dataTables_wrapper-->

            <table class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline">
               <thead>
                   <tr>
                     <th style="width: 80px;"> ID</th>
                     <th> Name</th>
                     <th class="text-center">Area</th>
                     <th>Description </th>
                     
                     <th style="width: 120px;">Last Update </th>
                     <th class="text-center" style=" width: 140px;">Status </th>
                     <th class="text-center" style="width: 120px;">Action</th>
                  </tr>
                  
               </thead>

               <tbody id='mytable'>
                  <tr class='row_tablecontent' style='display:none'>
                     <td class="route_id"> ID</td>
                     <td><a class="route_name route_edit_link">Name</a></td>
                     <th class="route_area"> Area</th>
                     <td class="route_description"> Description </td>
                    
                     <td class="route_lastupdate">Last Update </td>
                      <td class="route_status text-center"> Status </td>
                     <td class="text-center">
                        <button class="btn btn-silver btn-xs route_edit_link" title="edit" href="#">
                           <i class="fa fa-fw fa-pencil"></i>
                        </button>
                     </td>
                  </tr>
               </tbody>
            </table>
         </div>
         <!--/x_content-->
      </div>
      <!--/x_panel-->
   </div>
   <!--/col-md-12-->
</div>




<script>

   var template_of_testtable = $('#mytable').first().html();    // นำไปใส่ที่ <tbody id='mytable'>  และ <tr class='row_tablecontent' style='display:none'>

   //console.log(template_of_testtable);
   var maintable = $('#mytable').first();
//console.log("SET THE LINK mmmm:", i);
   //var i = 0;
   
    function showroute_list(searchstr){  // เพิ่มตัวแปรช่อง search ชื่อ searchstr
    
    $.get('/api/member/route_list/'+searchstr, function (objdata) {  // ลิงค์ที่กำหนดเพิ่มใน nodered
       console.log(objdata);
      
      
       $("#total_item").html(objdata.length);
       for (var x = 0; x < objdata.length; x++) {
          var TR = tablerow(maintable, 'route', objdata[x], template_of_testtable);

          //btn Edit
          TR.find('.route_edit_link').attr('href', '/cpanel/route/edit?routeid=' + objdata[x]._id);
          TR.show();
          if (objdata[x].status == 1) {
             TR.find('.route_status').text('เปิดการใช้งาน').attr('style', 'color : green');
          }
          if (objdata[x].status == 0) {
             TR.find('.route_status').text('ปิดการใช้งาน').attr('style', 'color : orange');
          }

       }
       
       //console.log("SET THE LINK :", i);

       $('.route_edit_link').on('click', function (obj) {
          /* กำหนดที่  <a href="#" class="route_route_name route_edit_link">  route Name </a> */
          //console.log($(obj).attr('href'));
          go2View($(obj.currentTarget).attr('href'), 'Editing route');
          return false;
       });
       return false;
    });
   }
   
   
    showroute_list(''); // ก่อนค้นหาข้อมูลให้เป็นค่าว่าง 
  
    // สำหรับค้นหาข้อมูล
    function filterFormsubmit(){
       //alert($('#search_route').val());
       $('#mytable').first().html(template_of_testtable) ; 
       if($('#search_route').val()){
            showroute_list($('#search_route').val());
        }else{
            showroute_list('');
        }
        return false; 
   }
   
   
   
   $('.alink').off("click");
   $('.alink').on('click', function (obj) {  // ตัวอย่าง <a href="cpanel/staff/qrcode" class='alink'>QR Code</a>
      go2View($(obj.target).attr('href'), 'Kapook Vending');
      return false;
   });

  

</script>