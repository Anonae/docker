<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!--start Breadcrumb-->
<style>
   .text-help { font-size: 11px; font-weight: 400; color: #ff5722; }

</style>
<nav aria-label="breadcrumb">
   <ol class="breadcrumb" >
      <li class="breadcrumb-item"><a href="cpanel/home" class="alink">Dashboard</a></li>
      <li class="breadcrumb-item"><a href="cpanel/kioskmodel/lists" class="alink" >Kiosk Models</a></li>

      <li class="breadcrumb-item active" aria-current="page">Edit</li>
   </ol>
</nav>
<!--/end Breadcrumb-->

<!-- // Start Content on PAGE /////////////////////////////////////////////////////// -->
<div class="row">
   <div class="content-title">
      <div class="col-md-8 col-sm-8 col-xs-12">
         <h2>Kiosk Model<b> Editor</b></h2>
      </div><!--/col-->

   </div><!--/content-title-->
</div><!--/row-->

<div class="row" id='kioskmodel_edit_page'>
   <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel">
         <div class="x_title">
            <p class="text-th">หน้าแก้ไข โมเดล ตู้กดน้ำ หมายเลข  <span>( <span class="kioskmodel_id"></span> | <span class="kioskmodel_model_name"></span>)</span></p>
         </div><!--/x_title-->


         <div class="x_content">
            <form id="editKioskmodel" class="form-horizontal form-label-left" method="POST" data-parsley-validate="" novalidate>
               <input type="hidden" name="action" value="editkioskmodel">
               <!-- <input id="bywho" name="bywho" value="<?=$_SESSION['name']?>" style="display:none;" />
               <input id="when" name="when" value="<?=date('Y-m-d H:i:s')?>" style="display:none;" />
               -->
               <div class="row">
                  <div class="col col-md-3 col-sm-4 col-xs-12">
                    	<div class="form-group" style="text-align:center;">

                        <!--   <img id="preview" src="" class="img-responsive" style="max-height:300px; margin:0 auto;">  -->

                        <div>
                           <img id="preview" src="" class="img-responsive kioskmodel_model_image" style="max-height:300px; margin:0 auto;" >
                        </div>

                        <div style=" width:100%; margin-top:30px; padding:10px; border:1px solid #e6ecf5; border-radius: 2px; overflow:hidden;">
                           <input type="file" name="previewimage" id="previewimage">
                           <input id="image" name="image" value=""  style="display:none;" />
                        </div>
                     </div>
                  </div><!--/col-->
                  <div class="col col-md-9 col-sm-8 col-xs-12">
                     <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12"><span class="required">*</span> Kiosk Name</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                           <!--                           <input class="form-control" type="text" id="name" name="name" value="<?=$loadKOS->name?>" />-->
                           <input class="form-control kioskmodel_model_name" type="text"  value="" required="required" id="kioskname" name="name" />
                           <span class="text-help  chk_name"></span>
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Placement</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                           <input class="resizable_textarea form-control kioskmodel_placement" rows="3" id="placement" name="placement"/>
                        </div>
                     </div>
                     <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">slot amount</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                           <input class="resizable_textarea form-control kioskmodel_slot_amount" rows="3" id="slotamount" name="slotamount" />
                        </div>
                     </div>

                     <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Description</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                           <textarea  class="resizable_textarea form-control kioskmodel_description" rows="5" id="description" name="description"></textarea>
                        </div>
                     </div>

                     <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Status</label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                           <select id="status"  class="kioskmodel_status form-control input-sm selectpicker selectCustomW100">
                              <option value="1">เปิดการใช้งาน</option>
                              <option value="0">ปิดการใช้งาน</option>
                           </select>

                        </div>
                     </div>
                  </div><!--/col-->
               </div><!--/row-->

               <div class="row">
                  <div class="ln_solid"></div>
                  <div class="col-md-3 col-sm-6 col-xs-12"><a href="/cpanel/kioskmodel/lists" class="alink btn btn-default btn-lg btn-block">Back</a></div>
                  <div class="col-md-9 col-sm-6 col-xs-12"><button class="btn btn-primary btn-lg btn-block "  type="submit" >Submit Edited</button></div>
               </div><!--/row-->
            </form>
         </div><!--/x_content-->
      </div><!--/x_panel-->
   </div><!--/col-md-12-->

</div><!--/row-->

<!-- // End Content on PAGE /////////////////////////////////////////////////////// -->


<script>
   var modeltimage_src
   $('.alink').off("click");
   $('.alink').on('click', function (obj) {
      go2View($(obj.target).attr('href'), 'Kapook Vending');
      return false;
   });
   var kioskidmodel_editing;

   function readURL_model(input) {
      if (input.files && input.files[0]) {
         $("#null_image").show();
         var reader = new FileReader();

         reader.onload = function (e) {

            $('#preview').attr('src', e.target.result);
            modeltimage_src = e.target.result;
         }

         reader.readAsDataURL(input.files[0]);
      }
   }

   $("#previewimage").change(function () {
      readURL_model(this);
   });




   //console.log(kioskid);
   function kioskmodel_showdata(kioskmodelid) {
      $.get('/api/member/kioskmodelid/' + kioskmodelid, function (data) {
         kioskmodel_editing = kioskmodelid;
         var objjquery = $('#kioskmodel_edit_page'); // อยู่ตรง Div Class ="Row
         
         setdatabyclass(objjquery, 'kioskmodel', data);
         console.log(data);
         if ($('#kioskname').val()) {
            $(".chk_name").removeClass('text-help');
         }

         //console.log(data.model_image);
//         if (data.model_image == "") {
//            //alert("555")
//            $("#null_image").hide();
//         } else {
//            //alert("ffff");
//            $("#null_image").show();
//         }

      });



   }
   //  $('#alert-success').hide();


   $('#editKioskmodel').on('submit', function () {  // ใช้กับ <form id="editPRD"
      //console.log('dddd');
      var errortext;
      // กำหนดตัวแปรแต่ละตัว ที่มาจากฟอร์ม
      var kioskname = $('#kioskname').val();
      var description = $('#description').val();
      var slot = $("#slotamount").val();
      var status = $("#status").val();
      var placement = $("#placement").val();
//      var image = $("#previewimage").val();
//      console.log($("#previewimage").val());

      if (kioskname == '') {
         // ค่าว่าง
         errortext = 'กรุณากรอก Model Name';
         $(".chk_name").show();
         $(".chk_name").addClass("text-help");
         $('.chk_name').html('กรุณากรอก model Name');
      } else {
         // กรอกข้อมูลเข้ามา
         $(".chk_name").hide();
         $(".chk_name").removeClass("text-help");
      }

      if (modeltimage_src.length > '2097152') {
         errortext = 'กรุณาเลือกรูปภาพขนาดไฟล์ที่อนุญาตน้อยกว่า 2 MB';
      }
      var texttitle = 'Edit Kiosk Model Error';
      if (errortext) {
         // แจ้ง error
         new PNotify({
            title: texttitle,
            text: errortext,
            modules: {
               Animate: {
                  animate: true,
                  inClass: 'zoomInLeft',
                  outClass: 'zoomOutRight'
               }
            }
         });

         return false;
      } else {


         console.log("SUBMIT" + '/api/member/kioskmodelid/' + kioskmodel_editing);
         var postdata
//         if ($("#previewimage").val() == "") {
//            postdata = {model_id: kioskmodel_editing, model_name: kioskname, model_description: description, model_slot: slot, model_status: status, model_placement: placement};
//         } else {
//            postdata = {model_id: kioskmodel_editing, model_name: kioskname, model_description: description, model_slot: slot, model_status: status, model_placement: placement, model_image: image};
//         }

         postdata = {model_id: kioskmodel_editing, model_name: kioskname, model_description: description, model_slot: slot, model_status: status, model_placement: placement, model_image: modeltimage_src};
         console.log(postdata);
         $.post('/api/member/kioskmodelid/' + kioskmodel_editing, postdata).done(function (data) {
            model_image: modeltimage_src = null;
            //  แจ้งบันทึกสำเร็จ
            new PNotify({
               title: texttitle,
               text: 'บันทึกข้อมูลสำเร็จ',
               type: 'success'
            });
            console.log("SUBMIT data " + data);
         });
      }

      console.log("return false");
      return false;
   });
</script>